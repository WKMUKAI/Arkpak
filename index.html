<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ARK_PAK_ | ARCHIVAL HOUSING</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initPlaces" async defer></script>
  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <style>
    :root { --g: #00a651; --b: #111; --w: #fff; --y: #ffed00; --grey: #f9f9f9; --err: #ff4444; }
    * { box-sizing: border-box; font-family: 'Quicksand', sans-serif; outline: none; }
    body { margin: 0; background: var(--w); color: var(--b); line-height: 1.6; padding-bottom: 50px; }
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn .4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    .container { max-width: 1000px; margin: 0 auto; padding: 0 20px; }
    .promo-bar { background: var(--y); text-align: center; padding: 10px; font-weight: 800; letter-spacing: 1px; font-size: 14px; }
    nav { padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; position: sticky; top: 0; background: var(--w); z-index: 1000; }
    .logo { font-weight: 700; font-size: 1.4rem; letter-spacing: -1px; cursor: pointer; } .logo span { color: var(--g); }
    .nav-menu { display: flex; gap: 30px; }
    .nav-btn { background: none; border: none; font-size: 13px; font-weight: 700; text-transform: uppercase; cursor: pointer; color: #888; transition: 0.2s; }
    .nav-btn:hover, .nav-btn.active { color: var(--g); }
    .order-cta { background: var(--b); color: #fff; padding: 8px 18px; border-radius: 20px; }
    .order-cta:hover { background: var(--g); color: #fff; }
    section { display: none; padding: 40px 0; }
    section.active-section { display: block; }
    .hero-text { text-align: center; margin-bottom: 40px; }
    .hero-text h1 { font-size: 2.5rem; margin-bottom: 10px; line-height: 1.2; }
    .hero-video { max-width: 800px; margin: 0 auto 40px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,.1); background: #f5f7fa; display: flex; align-items: center; justify-content: center; aspect-ratio: 16/9; }
    .trust-line { display: grid; grid-template-columns: repeat(4,1fr); gap: 10px; max-width: 900px; margin: 0 auto; text-align: center; font-size: 11px; } 
    .trust-line b { display: block; font-weight: 700; margin-top: 4px; color: var(--g); }
    .prod-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-top: 20px; }
    .prod-card-display { border: 1px solid #eee; border-radius: 20px; overflow: hidden; transition: 0.3s; background: var(--grey); }
    .prod-card-display:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
    .pc-img { height: 200px; background: #e0e0e0; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #888; position: relative; }
    .pc-img::after { content: "TEMPORARY IMAGE ‚Äì PRODUCT PHOTO COMING SOON"; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); font-size: 9px; color: #666; background: rgba(255,255,255,.9); padding: 2px 6px; border-radius: 4px; letter-spacing: .5px; }
    .pc-info { padding: 25px; text-align: center; }
    .pc-info h3 { margin: 0 0 10px 0; font-size: 1.2rem; }
    .pc-info p { font-size: 13px; color: #666; margin-bottom: 20px; min-height: 40px; }
    .config-card { max-width: 700px; margin: 0 auto; background: var(--grey); border-radius: 30px; padding: 30px; border: 2px solid #f0f0f0; box-shadow: 0 5px 20px rgba(0,0,0,.05); }
    h3 { margin-top: 0; font-size: 1.4rem; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; }
    label { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #666; margin-top: 15px; display: block; letter-spacing: .5px; }
    input, select, textarea { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 12px; margin-top: 5px; font-size: 14px; transition: .2s; }
    input:focus, select:focus, textarea:focus { border-color: var(--g); background: #fff; }
    .btn { background: var(--g); color: var(--w); padding: 16px; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; width: 100%; font-size: 16px; margin-top: 20px; transition: transform .1s; }
    .btn:active { transform: scale(.98); }
    .btn-secondary { background: var(--b); margin-top: 10px; font-size: 14px; padding: 12px; }
    .btn-outline { background: transparent; border: 2px solid var(--b); color: var(--b); margin-top: 10px; }
    .size-row { display: flex; gap: 10px; align-items: center; } .size-row input { text-align: center; }
    .box-line { background: #fff; border: 1px solid #e0e0e0; border-radius: 15px; padding: 15px; margin-bottom: 15px; position: relative; }
    .remove-btn { color: var(--err); font-size: 10px; text-decoration: underline; cursor: pointer; position: absolute; top: 10px; right: 15px; border: none; background: none; }
    #canvasBox { background: #f5f7fa; border: 1px solid #ddd; border-radius: 15px; margin-bottom: 20px; height: 250px; width: 100%; display: flex; justify-content: center; align-items: center; }
    canvas { width: 100%; height: 100%; }
    .price-display-container { background: var(--y); padding: 20px; border-radius: 20px; margin-top: 30px; text-align: center; border: 3px solid var(--b); }
    .price-value { font-size: 2.5rem; font-weight: 800; line-height: 1; } .price-sub { font-size: 12px; font-weight: 700; opacity: .8; margin-top: 5px; }
    .summary-box { background: #fff; padding: 20px; border-radius: 15px; border: 1px dashed #aaa; margin-bottom: 20px; font-size: 14px; } .summary-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 0; } .summary-row:last-child { border-bottom: none; }
    .contact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 20px; }
    .contact-info b { display: block; color: var(--g); text-transform: uppercase; font-size: 11px; margin-top: 20px; }
    .contact-info p { margin: 5px 0 0 0; font-size: 16px; font-weight: 600; }
    footer { text-align: center; padding: 40px; margin-top: 50px; border-top: 1px solid #eee; font-size: 11px; color: #999; }
  </style>
</head>
<body>

  <!-- PROMO BAR -->
  <div class="promo-bar">üöö HK DELIVERY ‚Äì Phase 1 Free delivery to HK and Kowloon.</div>

  <!-- NAV -->
  <nav>
    <div class="logo" onclick="switchPage('home')">ARK_PAK<span>_</span></div>
    <div class="nav-menu">
      <button class="nav-btn" onclick="switchPage('home')">About</button>
      <button class="nav-btn" onclick="switchPage('products')">Products</button>
      <button class="nav-btn" onclick="switchPage('contact')">Contact</button>
      <button class="nav-btn order-cta" onclick="switchPage('order')">Order Now</button>
    </div>
  </nav>

  <!-- HOME -->
  <section id="home-page" class="active-section fade-in">
    <div class="container">
      <div class="hero-text">
        <h1>Japanese Precision.<br>Handcrafted in Hong Kong.</h1>
        <p style="color:#666; max-width:600px; margin:0 auto;">
          ARK_PAK_ brings museum-grade archival standards to the local art scene. 
          Professional housing engineered for the pace of Hong Kong‚Äôs art market.
        </p>
      </div>
      <div class="hero-video">
        <div style="text-align:center; color:#999; font-size:13px; font-weight:600;">
          <span style="font-size:40px;">üñº</span><br>
          HERO VIDEO / IMAGE<br>
          <span style="font-size:11px;">(Temporary ‚Äì professional visuals coming soon)</span>
        </div>
      </div>
      <div class="trust-line" style="margin-top:40px;">
        <div>üçÑ ANTI-MOULD<b>Archival</b></div> <div>üíß WATER RES.<b>High Density</b></div>
        <div>‚ôªÔ∏è RECYCLE<b>Eco Core</b></div> <div>üöö HK DELIVERY<b>PHASE 1 FREE</b></div>
      </div>
      <div style="text-align:center; margin-top:40px;">
        <button class="btn" style="width:auto; padding: 15px 40px;" onclick="switchPage('products')">View Products</button>
      </div>
    </div>
  </section>

  <!-- PRODUCTS ‚Äì‚Äì  FINAL COPY  -->
  <section id="products-page" class="fade-in">
    <div class="container">
      <h2 style="text-align:center; margin-bottom:10px;">Our Systems</h2>
      <p style="text-align:center; color:#888; margin-bottom:40px;">Select a housing type to begin configuration.</p>

      <div class="prod-grid">

        <!--  1.  UKON BAG  -->
        <div class="prod-card-display">
          <div class="pc-img">üëò</div>
          <div class="pc-info">
            <h3>The Japanese Ukon Bag</h3>
            <p><strong>The Essential First Layer.</strong>
              ‚ÄúUkon (Japanese for Turmeric) is a traditional natural insect repellent. Our bags are crafted from a premium cotton-poly blend, traditionally turmeric-dyed to achieve their signature yellow hue and protective properties. The addition of polyester enhances the bag's durability, preventing shrinkage and ensuring it withstands the pace of frequent repacking. Designed to shield delicate surfaces from abrasions, the fabric allows for a smooth 'glide'‚Äîmaking it effortless to pull work out of a box or hand over to a client.‚Äù
            </p>
            <button class="btn" style="margin-top:0" onclick="selectProduct('ukon')">Configure</button>
          </div>
        </div>

        <!--  2.  SLIDE BOX  -->
        <div class="prod-card-display">
          <div class="pc-img">üìÇ</div>
          <div class="pc-info">
            <h3>The Slide Box</h3>
            <p><strong>Precision & Presentation.</strong>
              ‚ÄúThe side-loading slipcase is engineered for flat works, prints, and galleries requiring frequent viewing access. It is the ultimate logistical tool‚Äîsuper easy to unpack and repack, making it the perfect housing for client handovers. Every corner is reinforced with industrial-grade archival tape, and the system features a signature rope-lock closure to ensure the work remains secure during transit.‚Äù
            </p>
            <button class="btn" style="margin-top:0" onclick="selectProduct('slide')">Configure</button>
          </div>
        </div>

        <!--  3.  COVER BOX  -->
        <div class="prod-card-display">
          <div class="pc-img">üì¶</div>
          <div class="pc-info">
            <h3>The Cover Box</h3>
            <p><strong>Structural Strength & Scalability.</strong>
              ‚ÄúA heavy-duty, top-loading system featuring a reinforced lid. Optimized for deep canvases and framed works, the Cover Box is engineered for extreme durability. By increasing the wall thickness beyond a double-layer configuration, it transforms into a high-performance 'Studio Crate'‚Äîa lightweight, rigid alternative to traditional timber crates. It offers the structural integrity needed for transport without the bulk, weight, or disposal challenges of wood. Coming in Phase II: Integrated high-density padding options for customizable impact resistance.‚Äù
            </p>
            <button class="btn" style="margin-top:0" onclick="selectProduct('cover')">Configure</button>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- ORDER ‚Äì‚Äì  NEW VISUAL GAP SYSTEM  -->
  <section id="order-page" class="fade-in">
    <div class="container">
      <div class="config-card" id="step1">
        <h3>01 Specs & Inner Fit</h3>

        <!-- VISUAL GAP CANVAS (your new system) -->
        <div id="canvasBox">
          <canvas id="boxCanvas"></canvas>
        </div>

        <!-- BOX-TYPE PREVIEW IMAGE -->
        <div style="text-align:center; margin:15px 0;">
          <img id="boxTypeImage" src="https://via.placeholder.com/300x150?text=Cover+Box" alt="Box preview" style="max-width:100%;height:auto;border-radius:12px;">
        </div>

        <label>Product Type</label>
        <select id="prodType" onchange="prodChanged()">
          <option value="cover">Cover Box</option>
          <option value="slide">Slide Box</option>
          <option value="ukon">Ukon Bag</option>
        </select>

        <label>Inner Fit (Determine Gap)</label>
        <select id="fitType" onchange="fitTypeChanged()">
          <option value="standard">Standard (1.5 cm Gap for Bubble Wrap)</option>
          <option value="ukon">Ukon Snug (0 cm Gap)</option>
          <option value="custom">Custom Gap</option>
        </select>

        <div id="customGapBox" class="hidden">
          <label>Custom Gap (cm)</label>
          <input type="number" id="customGap" value="1.5" step="0.5" min="0" max="10" oninput="updateCanvas();calcPrice()">
        </div>

        <!-- DIMENSIONS + 120 cm CLAMP -->
        <label>Artwork Dimensions (cm) <small style="color:var(--err);font-weight:600;">MAX 120</small></label>
        <div class="size-row">
          <div><input type="number" id="dimW" value="50" max="120" oninput="clamp120(this);updateCanvas();calcPrice()" placeholder="W"></div>
          <div style="padding-top:10px">√ó</div>
          <div><input type="number" id="dimH" value="40" max="120" oninput="clamp120(this);updateCanvas();calcPrice()" placeholder="H"></div>
          <div style="padding-top:10px">√ó</div>
          <div><input type="number" id="dimD" value="5" max="120" oninput="clamp120(this);calcPrice()" placeholder="D"></div>
        </div>

        <!-- WALL THICKNESS (moved out of black block) -->
        <label>Wall Thickness</label>
        <select id="wallThick" onchange="calcPrice()">
          <option value="1">1 Layer (Standard Rigid)</option>
          <option value="1.2">2 Layers (Extra Rigid +20%)</option>
          <option value="custom">3+ Layers (Custom Quote)</option>
        </select>

        <!-- QUANTITY + ADD BOX -->
        <label>Quantity for next size</label>
        <input id="qty" type="number" value="1" min="1" oninput="calcPrice()">
        <button type="button" class="btn btn-outline" onclick="addBox()">+ Add another size</button>

        <!-- LIVE PRICE -->
        <div class="price-display-container">
          <div class="price-value" id="totalDisplay">$0</div>
          <div class="price-sub" id="breakdownDisplay">Calculating‚Ä¶</div>
        </div>
        <div id="customQuoteBox" class="price-display-container hidden">
          <div class="price-value">Custom Quote</div>
          <a href="mailto:studio@arkpak.hk?subject=Custom Quote Request" class="btn" style="background:#25D366;margin-top:10px">Contact Studio ‚úâÔ∏è</a>
        </div>

        <button class="btn" onclick="calcNextStep(2)">Next Logistics ‚Üí</button>
      </div>

      <!-- STEP 2 ‚Äì LOGISTICS -->
      <div class="config-card hidden" id="step2">
        <h3>02 Logistics</h3>
        <label>Contact Name</label><input id="cName" type="text" placeholder="Your Name">
        <label>WhatsApp Number</label><input id="cTel" type="tel" placeholder="+852 1234 5678">
        <label>Email Address</label><input id="cEmail" type="email" placeholder="you@example.com">
        <label>Delivery Address</label><input id="cAddr" type="text" placeholder="Start typing address‚Ä¶" autocomplete="off">
        <label>Region (Phase 1 ‚Äì Free Delivery)</label>
        <select id="hkRegion" onchange="calcPrice()">
          <option>HK and Kowloon (Free)</option>
          <option>New Territories (+$150)</option>
          <option>Remote Islands (Quote)</option>
        </select>
        <label>Delivery Notes</label><textarea id="delNote" rows="2" placeholder="Stairs, concierge, gate code‚Ä¶"></textarea>
        <button class="btn" onclick="calcNextStep(3)">Review Quote ‚Üí</button>
        <button class="btn btn-secondary" onclick="calcPrevStep(1)">‚Üê Back</button>
      </div>

      <!-- STEP 3 ‚Äì REVIEW & SEND -->
      <div class="config-card hidden" id="step3">
        <h3>03 Review Quote</h3>
        <div id="summary" class="summary-box"></div>
        <div class="price-display-container">
          <div class="price-value" id="finalTotal">$0</div>
          <div class="price-sub">Payable via PayMe / Bank Transfer</div>
        </div>
        <button class="btn" style="background:#25D366" onclick="sendOrder('whatsapp')">Confirm via WhatsApp üí¨</button>
        <button class="btn btn-secondary" onclick="sendOrder('email')">Send via Email ‚úâÔ∏è</button>
        <button class="btn btn-outline" onclick="calcPrevStep(2)">‚Üê Edit</button>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact-page" class="fade-in">
    <div class="container">
      <div class="config-card">
        <h3>Contact Us</h3>
        <p>ARK_PAK_ is a dedicated archival housing studio based in Hong Kong. We work with galleries, museums, and private collectors.</p>
        <div class="contact-grid">
          <div class="contact-info">
            <b>Studio WhatsApp</b>
            <p>+852 5596 2339</p>
            <b>Email Inquiries</b>
            <p>studio@arkpak.hk</p>
            <b>Service Area</b>
            <p>Hong Kong Island, Kowloon, New Territories</p>
          </div>
          <div>
            <label>Send a quick message</label>
            <textarea id="quickMsg" style="height:120px" placeholder="How can we help?"></textarea>
            <button class="btn" onclick="window.location.href='mailto:studio@arkpak.hk?body='+encodeURIComponent(document.getElementById('quickMsg').value)">Send Email</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>ARK_PAK_ STUDIO // 2026 // HONG KONG</footer>

  <script>
    /* ----------  EMAILJS  ---------- */
    emailjs.init("YOUR_PUBLIC_KEY");

    /* ----------  NAVIGATION  ---------- */
    function switchPage(pageName) {
      document.querySelectorAll('section').forEach(el => el.classList.remove('active-section'));
      document.getElementById(pageName + '-page').classList.add('active-section');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    function selectProduct(prodType) {
      document.getElementById('prodType').value = prodType;
      prodChanged(); switchPage('order');
    }

    /* ----------  STEP NAVIGATION  ---------- */
    function calcNextStep(step){
      if(step===3 && (!document.getElementById('cName').value.trim() || !document.getElementById('cTel').value.trim())){
        alert('Please enter Name and WhatsApp number'); return;
      }
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.add('hidden');
      document.getElementById('step'+step).classList.remove('hidden');
      document.getElementById('step'+step).scrollIntoView({behavior:'smooth', block:'start'});
      if(step===3){ generateSummary(); document.getElementById('finalTotal').textContent = document.getElementById('totalDisplay').textContent; }
    }
    function calcPrevStep(n){
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.add('hidden');
      document.getElementById('step'+n).classList.remove('hidden');
    }

    /* ----------  PRODUCT / OPTION SWITCH  ---------- */
    let activeProduct = 'cover', boxCount = 1;
    function prodChanged(){
      activeProduct = document.getElementById('prodType').value;
      const isBox = activeProduct !== 'ukon';
      document.getElementById('canvasBox').classList.toggle('hidden', !isBox);
      document.getElementById('dimBlock').classList.toggle('hidden', !isBox);
      // update main preview image
      document.getElementById('boxTypeImage').src = boxImageMap(activeProduct);
      calcPrice(); updateCanvas();
    }

    /* ----------  BOX PREVIEW IMAGES  ---------- */
    function boxImageMap(type){
      // REPLACE WITH YOUR OWN URLS
      if(type==='slide') return 'https://via.placeholder.com/300x150?text=Slide+Box';
      return 'https://via.placeholder.com/300x150?text=Cover+Box'; // default
    }

    /* ----------  ADD / REMOVE BOX  ---------- */
    function addBox(){
      const container = document.getElementById('boxesContainer');
      const qty = parseInt(document.getElementById('qty').value)||1;
      const id = `box_${boxCount++}`;
      container.insertAdjacentHTML('beforeend', `
        <div class="box-line fade-in" id="${id}">
          <button class="remove-btn" onclick="removeBox('${id}')">REMOVE</button>

          <label style="margin-top:0">Box Type</label>
          <select class="lineBoxType" onchange="calcPrice();updateCanvas();updateLineImage(this)">
            <option value="cover">Cover Box</option>
            <option value="slide">Slide Box</option>
          </select>
          <!-- LIVE IMAGE FOR THIS LINE -->
          <div class="line-img-box" style="text-align:center;margin:10px 0;">
            <img class="lineBoxImg" src="https://via.placeholder.com/280x120?text=Cover+Box" alt="Line preview" style="max-width:100%;height:auto;border-radius:8px;">
          </div>

          <label>Artwork Dimensions (cm) <small style="color:var(--err);font-weight:600;">MAX 120</small></label>
          <div class="size-row">
            <div><input type="number" class="dim-w" value="50" max="120" oninput="clamp120(this);updateCanvas();calcPrice()" placeholder="W"></div>
            <div style="padding-top:10px">√ó</div>
            <div><input type="number" class="dim-h" value="40" max="120" oninput="clamp120(this);updateCanvas();calcPrice()" placeholder="H"></div>
            <div style="padding-top:10px">√ó</div>
            <div><input type="number" class="dim-d" value="5" max="120" oninput="clamp120(this);calcPrice()" placeholder="D"></div>
          </div>
        </div>`);
      calcPrice();
    }
    function removeBox(id){ const el=document.getElementById(id); if(el){el.remove(); calcPrice();} }

    /* ----------  120 cm CLAMP  ---------- */
    function clamp120(el){ if(el.value>120) el.value=120; }

    /* ----------  UPDATE LINE IMAGE  ---------- */
    function updateLineImage(select){
      const img = select.parentNode.querySelector('.lineBoxImg');
      img.src = boxImageMap(select.value);
    }

    /* ----------  OPTION SWITCH  ---------- */
    function fitTypeChanged(){
      const ft = document.getElementById('fitType').value;
      document.getElementById('customGapBox').classList.toggle('hidden', ft !== 'custom');
      updateCanvas(); calcPrice();
    }

    /* ----------  VISUAL GAP CANVAS (your new system)  ---------- */
    function resizeCanvas(){
      const c=document.getElementById('boxCanvas'), b=document.getElementById('canvasBox');
      c.width=b.offsetWidth; c.height=b.offsetHeight;
      updateCanvas();
    }
    function updateCanvas(){
        const c=document.getElementById('boxCanvas'), ctx=c.getContext('2d');
        const cw=c.width, ch=c.height;
        ctx.clearRect(0,0,cw,ch);

        // Artwork size
        const w=parseFloat(document.getElementById('dimW').value)||30;
        const h=parseFloat(document.getElementById('dimH').value)||30;

        // Gap
        const fit=document.getElementById('fitType').value;
        let gap=0;
        if(fit==='standard') gap=1.5;
        else if(fit==='custom') gap=parseFloat(document.getElementById('customGap').value)||0;

        const totalW=w+gap*2, totalH=h+gap*2;
        const scale=(Math.min(cw,ch)*0.7)/Math.max(totalW,totalH);
        const sw=w*scale, sh=h*scale, sg=gap*scale;
        const cx=cw/2, cy=ch/2;

        // 1. Artwork (dashed)
        ctx.setLineDash([5,5]);
        ctx.strokeStyle='#999'; ctx.lineWidth=2;
        ctx.strokeRect(cx-sw/2, cy-sh/2, sw, sh);

        // 2. Box (solid green)
        ctx.setLineDash([]);
        ctx.strokeStyle='#00a651'; ctx.lineWidth=3;
        ctx.strokeRect(cx-(sw/2+sg), cy-(sh/2+sg), sw+sg*2, sh+sg*2);

        // 3. Labels
        ctx.fillStyle='#00a651'; ctx.font='bold 12px Quicksand';
        ctx.fillText(`BOX: ${totalW}cm`, 20, 30);
        ctx.fillStyle='#999';
        ctx.fillText(`ART: ${w}cm`, 20, 50);
        if(gap>0) ctx.fillText(`GAP: ${gap}cm`, 20, 70);
    }

    /* ----------  PRICING ENGINE  ---------- */
    function calcPrice(){
      const wall=document.getElementById('wallThick').value;
      const region=document.getElementById('hkRegion').value;
      let itemTotal=0;

      if(wall==='custom' || region==='Remote Islands (Quote)'){
        document.getElementById('priceBox').classList.add('hidden');
        document.getElementById('customQuoteBox').classList.remove('hidden');
        return;
      }
      document.getElementById('priceBox').classList.remove('hidden');
      document.getElementById('customQuoteBox').classList.add('hidden');

      if(activeProduct==='ukon'){
        const unitPrice={A4:85,A3:120,A2:180}[activeProduct]||120;
        const qty=parseInt(document.getElementById('qty').value)||1;
        itemTotal=unitPrice*qty;
      }else{
        let fitCost=0;
        const fit=document.getElementById('fitType').value;
        if(fit==='ukon') fitCost=85;
        if(fit==='custom'){
          const gap=parseFloat(document.getElementById('customGap').value)||0;
            fitCost=gap*10;
        }
        document.querySelectorAll('.box-line').forEach(box=>{
          const type=box.querySelector('.lineBoxType').value;
          const w=parseFloat(box.querySelector('.dim-w').value)||0;
          const h=parseFloat(box.querySelector('.dim-h').value)||0;
            const d=parseFloat(box.querySelector('.dim-d').value)||0;
          const qty=parseInt(document.getElementById('qty').value)||1;
          if(w>0&&h>0){
            const per=(w+h)*2; let base=0;
            if(per<100) base=150; else if(per<200) base=280; else if(per<300) base=450; else base=600;
            if(type==='slide') base*=1.1;
            if(wall==='1.2') base*=1.2;
            itemTotal+=(base+fitCost)*qty;
          }
        });
      }

      let delivery=0;
      if(region==='New Territories (+$150)') delivery=150;
      const grand=itemTotal+delivery;
      document.getElementById('totalDisplay').textContent=`$${Math.round(grand)}`;
      document.getElementById('breakdownDisplay').textContent=`${document.querySelectorAll('.box-line').length} size(s) | ${delivery===0?'Free Shipping':`+$${delivery} Shipping`}`;
    }

    /* ----------  SUMMARY  ---------- */
    function generateSummary(){
      const name=document.getElementById('cName').value;
      const tel=document.getElementById('cTel').value;
      const email=document.getElementById('cEmail').value;
      const addr=document.getElementById('cAddr').value;
      const region=document.getElementById('hkRegion').value;
      const note=document.getElementById('delNote').value;
      const prod=document.getElementById('prodType').value;
      const wall=document.getElementById('wallThick').value;
      const fit=document.getElementById('fitType').value;
      let gapText='';
      if(fit==='standard') gapText='Standard Bubble Wrap';
      else if(fit==='ukon') gapText='Snug (ukon)';
      else gapText=document.getElementById('customGap').value+' cm';

      let items='';
      if(prod==='ukon'){
        items=`<div class="summary-row"><span>Ukon Bag</span><span>Qty: ${document.getElementById('qty').value}</span></div>`;
      }else{
        document.querySelectorAll('.box-line').forEach((box,i)=>{
          const type=box.querySelector('.lineBoxType').value;
          const w=box.querySelector('.dim-w').value;
          const h=box.querySelector('.dim-h').value;
            const d=box.querySelector('.dim-d').value;
          items+=`<div class="summary-row"><span>Box #${i+1} (${type}) ${w}√ó${h}√ó${d} cm</span></div>`;
        });
      }

      document.getElementById('summary').innerHTML=`
        <div style="margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid #eee">
          <strong>${name}</strong><br>${tel}<br>${email}<br>${addr}<br>(${region})
        </div>
        <div class="summary-row"><span>Type</span><span>${prod.toUpperCase()}</span></div>
        <div class="summary-row"><span>Wall</span><span>${wall==='1.2'?'2 Layers':'1 Layer'}</span></div>
        <div class="summary-row"><span>Fit</span><span>${gapText}</span></div>
        ${items}`;
    }

    /* ----------  SEND ORDER  ---------- */
    async function sendOrder(via){
      const customer = {
        name: document.getElementById('cName').value,
        tel:  document.getElementById('cTel').value,
        email:document.getElementById('cEmail').value,
        addr: document.getElementById('cAddr').value
      };
      const region = document.getElementById('hkRegion').value;
      const note   = document.getElementById('delNote').value;
      const total  = document.getElementById('finalTotal').textContent;

      let itemList = "";
      document.querySelectorAll('.box-line').forEach((b,i)=>{
         const type=b.querySelector('.lineBoxType').value;
         const w=b.querySelector('.dim-w').value;
         const h=b.querySelector('.dim-h').value;
         const d=b.querySelector('.dim-d').value;
         itemList += `Box ${i+1} (${type}) ${w}√ó${h}√ó${d}cm\n`;
      });

      // 1.  Email confirmation (must succeed)
      try {
        await emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", {
          customer_name: customer.name,
          customer_email: customer.email,
          customer_tel: customer.tel,
          customer_addr: customer.addr,
          region: region,
          note: note,
          items: itemList,
          total: total
        });
      } catch (err) {
        console.error(err);
        alert('Sorry, we could not send the confirmation email. Please try again or contact us directly.');
        return; // <-- stop here; do NOT open WhatsApp
      }

      // 2.  Only after email success ‚Üí open WhatsApp / mailto
      const msg = `[ARK_PAK ORDER]
Name: ${customer.name}
Tel: ${customer.tel}
Email: ${customer.email}
Region: ${region}
Total: ${total}
Items:
${itemList}`;
      if (via === 'whatsapp') {
        window.open(`https://wa.me/85255962339?text=${encodeURIComponent(msg)}`, '_blank');
      } else {
        window.location.href = `mailto:studio@arkpak.hk?subject=Order ${customer.name}&body=${encodeURIComponent(msg)}`;
      }
    }

    /* ----------  MAPS  ---------- */
    function initPlaces(){
      const input=document.getElementById('cAddr');
      if(!input) return;
      try{ new google.maps.places.Autocomplete(input,{types:['geocode'],componentRestrictions:{country:'hk'}}); }
      catch(e){ console.warn('Maps API not ready'); }
    }

    /* ----------  BOOT  ---------- */
    window.addEventListener('load',()=>{ prodChanged(); calcPrice(); resizeCanvas(); });
  </script>
</body>
</html>
